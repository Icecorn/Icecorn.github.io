<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>GPU架构（一）|Tesla架构 | Blog of Icecorn</title>
  <meta name="description" content="GPU架构(一) | Tesla架构SIMTSIMT：single instruction，multiple threads SIMT类似CPU上的多线程。最简单的理解SIMT的是想象有这样一个多核系统，每一个core有自己的寄存器文件、自己的ALU、自己的data cache，但是没有独立的instruction cache、没有独立的解码器、没有独立的Program Counter regis">
<meta property="og:type" content="article">
<meta property="og:title" content="GPU架构（一）|Tesla架构">
<meta property="og:url" content="http://icecorn.github.io/2022/07/01/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%B8%80)%20Tesla%E6%9E%B6%E6%9E%84/index.html">
<meta property="og:site_name" content="Blog of Icecorn">
<meta property="og:description" content="GPU架构(一) | Tesla架构SIMTSIMT：single instruction，multiple threads SIMT类似CPU上的多线程。最简单的理解SIMT的是想象有这样一个多核系统，每一个core有自己的寄存器文件、自己的ALU、自己的data cache，但是没有独立的instruction cache、没有独立的解码器、没有独立的Program Counter regis">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710133404872.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710134553236.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710135929296.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-29d8a02a890d4174d8d30f9241b46d88_r.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-07c156f620b46a6287e759dcf00f93cf_r.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-458a6b35cd6a371dc3838594422d9e4f_r.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-d9689b21d2fcac3045886bdfcee3f565_720w.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-36f03e7fa80a9530c71ad87faca8034a_720w.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-b3501fecde229b3f4223f609d67bda03_720w.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710142551173.png">
<meta property="article:published_time" content="2022-07-01T09:25:10.000Z">
<meta property="article:modified_time" content="2022-07-23T02:34:59.125Z">
<meta property="article:author" content="Icecorn">
<meta property="article:tag" content="GPU架构">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710133404872.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://icecorn.github.io/2022/07/01/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%B8%80)%20Tesla%E6%9E%B6%E6%9E%84/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Blog of Icecorn" type="application/atom+xml">
  
  
    <link rel="icon" href="images/logo.jpg" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.2"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/Icecorn" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Icecorn</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Life is Fantastic ~</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> DaLian, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>QAQ~</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/C/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/GPU%E6%9E%B6%E6%9E%84/">GPU架构</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReadingNotes/">ReadingNotes</a><span class="category-list-count">25</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ReadingNotes/C/">C++</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReadingNotes/Linux/">Linux</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ReadingNotes/Linux/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/">系统编程</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/%E6%B8%B2%E6%9F%93/">渲染</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%B2%E6%9F%93/">渲染</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-Primer/" rel="tag">C++ Primer</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/" rel="tag">C++内存管理机制</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU%E6%9E%B6%E6%9E%84/" rel="tag">GPU架构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF/" rel="tag">GPU渲染管线</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games-101/" rel="tag">Games-101</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games-104/" rel="tag">Games-104</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">Linux高性能服务器</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBR%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF/" rel="tag">PBR渲染管线</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rasterizer/" rel="tag">Rasterizer</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/divide-conquer/" rel="tag">divide&conquer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openGL/" rel="tag">openGL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shader/" rel="tag">shader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket%E7%BC%96%E7%A8%8B/" rel="tag">socket编程</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E6%B1%A0/" rel="tag">内存池</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" rel="tag">动态规划</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" rel="tag">图形学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E8%BF%9B%E7%A8%8B/" rel="tag">多进程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" rel="tag">思维导图</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" rel="tag">游戏引擎</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1/" rel="tag">面试八股</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/C-Primer/" style="font-size: 14px;">C++ Primer</a> <a href="/tags/C-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/" style="font-size: 13.33px;">C++内存管理机制</a> <a href="/tags/GPU%E6%9E%B6%E6%9E%84/" style="font-size: 13.17px;">GPU架构</a> <a href="/tags/GPU%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF/" style="font-size: 13px;">GPU渲染管线</a> <a href="/tags/Games-101/" style="font-size: 13.17px;">Games-101</a> <a href="/tags/Games-104/" style="font-size: 13.67px;">Games-104</a> <a href="/tags/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 13.83px;">Linux高性能服务器</a> <a href="/tags/Markdown/" style="font-size: 13px;">Markdown</a> <a href="/tags/PBR%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF/" style="font-size: 13px;">PBR渲染管线</a> <a href="/tags/Rasterizer/" style="font-size: 13.17px;">Rasterizer</a> <a href="/tags/divide-conquer/" style="font-size: 13px;">divide&conquer</a> <a href="/tags/openGL/" style="font-size: 13px;">openGL</a> <a href="/tags/shader/" style="font-size: 13px;">shader</a> <a href="/tags/socket%E7%BC%96%E7%A8%8B/" style="font-size: 13.33px;">socket编程</a> <a href="/tags/%E5%86%85%E5%AD%98%E6%B1%A0/" style="font-size: 13px;">内存池</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 13.17px;">动态规划</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">单例模式</a> <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 13px;">图形学</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 13px;">多线程</a> <a href="/tags/%E5%A4%9A%E8%BF%9B%E7%A8%8B/" style="font-size: 13px;">多进程</a> <a href="/tags/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" style="font-size: 13px;">思维导图</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 13px;">排序</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 13px;">操作系统</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" style="font-size: 13.67px;">游戏引擎</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.83px;">算法</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 13.5px;">计算机网络</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1/" style="font-size: 13px;">面试八股</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/C/">C++</a>
              </p>
              <p class="item-title">
                <a href="/2022/08/03/%E9%9D%A2%E8%AF%95%E5%85%AB%E8%82%A1/" class="title">面试八股|C++篇</a>
              </p>
              <p class="item-date">
                <time datetime="2022-08-03T09:25:10.000Z" itemprop="datePublished">2022-08-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a>
              </p>
              <p class="item-title">
                <a href="/2022/08/01/Games-104/Games104--%E9%AB%98%E7%BA%A7%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF9/" class="title">Games-104|第九课-高级动画计数</a>
              </p>
              <p class="item-date">
                <time datetime="2022-08-01T09:25:10.000Z" itemprop="datePublished">2022-08-01</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a>
              </p>
              <p class="item-title">
                <a href="/2022/07/31/Games-104/Games104--%E5%8A%A8%E7%94%BB%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%808/" class="title">Games-104|第八课-动画技术基础</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-31T09:25:10.000Z" itemprop="datePublished">2022-07-31</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
              </p>
              <p class="item-title">
                <a href="/2022/07/09/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97%20%E7%BB%8F%E5%85%B8%E9%A2%98%E7%9B%AE%E5%90%88%E9%9B%86/" class="title">算法系列|经典题目合集</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-09T09:25:10.000Z" itemprop="datePublished">2022-07-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
              </p>
              <p class="item-title">
                <a href="/2022/07/08/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%94%EF%BC%89%E8%82%A1%E7%A5%A8%E4%BA%A4%E6%98%93/" class="title">算法系列（五）|股票交易</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-08T09:25:10.000Z" itemprop="datePublished">2022-07-08</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GPU%E6%9E%B6%E6%9E%84-%E4%B8%80-Tesla%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">GPU架构(一) | Tesla架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SIMT"><span class="toc-number">1.1.</span> <span class="toc-text">SIMT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tesla%E6%9E%B6%E6%9E%84%E4%B8%80%E8%A7%88"><span class="toc-number">1.2.</span> <span class="toc-text">Tesla架构一览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">各模块的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B2%E6%B4%BB%E4%B8%BB%E5%8A%9BTPC"><span class="toc-number">1.2.2.</span> <span class="toc-text">干活主力TPC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%9D%A1%E8%88%B9%E4%B8%8A%E7%9A%84%E8%9A%82%E8%9A%B1"><span class="toc-number">1.2.3.</span> <span class="toc-text">一条船上的蚂蚱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B4%BB%E5%84%BF%E5%8F%AF%E4%BB%A5%E7%AD%89%EF%BC%8C%E6%89%93%E5%B7%A5%E4%BA%BA%E4%B8%8D%E8%83%BD%E7%AD%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">活儿可以等，打工人不能等</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E5%9B%BE%E5%BD%A2%E5%88%B0%E9%80%9A%E7%94%A8%E8%AE%A1%E7%AE%97"><span class="toc-number">1.3.</span> <span class="toc-text">从图形到通用计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CUDA%E5%92%8C%E8%AE%A1%E7%AE%97%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">CUDA和计算着色器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">线程组织结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8D%95%E5%85%83%E6%98%AFWarp"><span class="toc-number">1.4.2.</span> <span class="toc-text">真正的并行单元是Warp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BA%A7%E2%80%9C%E7%89%A9%E6%B5%81%E2%80%9D%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.</span> <span class="toc-text">分级“物流”系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Global-Memory%E4%B8%8EL2-cache"><span class="toc-number">1.5.1.</span> <span class="toc-text">Global Memory与L2 cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shared-Memory%E4%B8%8EL1-cache"><span class="toc-number">1.5.2.</span> <span class="toc-text">Shared Memory与L1 cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Local-Memory%E4%B8%8ERegister-Files"><span class="toc-number">1.5.3.</span> <span class="toc-text">Local Memory与Register Files</span></a></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-GPU架构/GPU架构系列(一) Tesla架构" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      GPU架构（一）|Tesla架构
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/07/01/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%B8%80)%20Tesla%E6%9E%B6%E6%9E%84/" class="article-date">
	  <time datetime="2022-07-01T09:25:10.000Z" itemprop="datePublished">2022-07-01</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/GPU%E6%9E%B6%E6%9E%84/">GPU架构</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/GPU%E6%9E%B6%E6%9E%84/" rel="tag">GPU架构</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/07/01/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%B8%80)%20Tesla%E6%9E%B6%E6%9E%84/#comments" class="article-comment-link">Comments</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 6.2k(words)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 21(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="GPU架构-一-Tesla架构"><a href="#GPU架构-一-Tesla架构" class="headerlink" title="GPU架构(一) | Tesla架构"></a>GPU架构(一) | Tesla架构</h1><h2 id="SIMT"><a href="#SIMT" class="headerlink" title="SIMT"></a>SIMT</h2><p>SIMT：single instruction，multiple threads</p>
<p>SIMT类似CPU上的多线程。最简单的理解SIMT的是想象有这样一个多核系统，每一个core有自己的寄存器文件、自己的ALU、自己的data cache，但是没有独立的instruction cache、没有独立的解码器、没有独立的Program Counter register，命令是从单一的instruction cache同时被广播给多个SIMT core的。<strong>即所有的core是各有各的执行单元，数据不同，执行的命令确是相同的。多个线程各有各的处理单元，和SIMD公用一个ALU不同。</strong></p>
<p>因为大量的并行计算需求，从而导致了GPU的产生</p>
<h2 id="Tesla架构一览"><a href="#Tesla架构一览" class="headerlink" title="Tesla架构一览"></a>Tesla架构一览</h2><p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710133404872.png" alt="image-20220710133404872"></p>
<ul>
<li>最上面的是尊敬的甲方CPU；整个GPU是一个巨大的外包公司，负责干各种又脏又累的活</li>
<li>外包公司内，最上层的是各种大小包工头；中间是一堆负责干活的社畜；最下方是堆放原料和产品的码头和仓库</li>
<li>我们可能会发现一个特点，除了负责指挥的包工头，下面干活的社畜以及吞吐数据的码头和仓库，似乎有好几个，长得还一模一样，这就是<strong>GPU并行性在具体硬件结构上的体现</strong>。</li>
</ul>
<h3 id="各模块的作用"><a href="#各模块的作用" class="headerlink" title="各模块的作用"></a>各模块的作用</h3><ul>
<li><strong>Host Interface</strong>：外包公司的大包工头，负责收发来自甲方CPU的各种订单（多是枯燥无味重复单调，需要大量廉价劳动力，CPU自己不屑于干、做不来的活）并处理GPU在各种订单间的上下文切换；还负责获取来自内存等待加工的原材料（顶点数据、纹理数据、各种buffer等），将其存放到仓库（显存）中。</li>
<li><strong>Input Assembler</strong>：负责将甲方给的顶点数据进行简单组装（根据顶点索引与图元类型装配），并搭配上属于它们的顶点属性，才能传给Vertex Work Distribution。</li>
<li><strong>Vertex、Pixel、Compute Work Distribution</strong>：三个小包工头，负责将自己领域更加具体的工作分发给底下一大堆流水线工人们去做（从名字就可以看出，他们分别分发顶点、片元和计算着色器的任务）。</li>
<li><strong>TPC（Texture Processing Clusters）</strong>：这个名字比较令人困惑，里面有<strong>一个纹理单元和两个负责计算的SM（Streaming Multiprocessor）</strong>。都是干活的生力军，上面三个小包工头的活全都是它们完成的，从这里就可以看出所谓的统一的硬件结构是指什么了。这个结构下一章会具体展开，先让我们记住这个啥都能做的“全栈工程师”。</li>
<li><strong>Viewport/clip/setup/raster/zcull block</strong>：顶点着色器处理完，只是输出一堆裁剪坐标（还未透视除法）和一堆与其一起等待光栅化插值的属性，这个模块就是负责这些，流水线中到目前为止都未开放编程的固定功能部分。</li>
<li><strong>ROP（Raster Operations Processor）</strong>：除了格子间里流水线上的工人，身为码头工人的ROP也是任劳任怨的好员工。他们负责对片元着色器处理后的像素进行测试和装箱：同一个像素位置的<strong>深度/模板测试和写入、颜色混合、抗锯齿</strong>都由它完成。因为片元着色器处理一个位置的片元时，并不知道该位置其他片元的信息，所以需要有这么一位码头工人在最终将产品（像素颜色）发往仓库前，做最后的统筹合并修缮工作。</li>
<li><strong>L2 Cache、Memory Controller和DRAM</strong>：从图上可以看到，每个仓库（DRAM）搭配一个码头（图中未标的Memory Controller）、码头临时库存（L2 Cache）和一个码头工人（ROP），共有6组这样的搭配，每个搭配对应着显存六分之一的物理地址。格子间TPC里并行工作着的SM们发来了一条又一条的数据吞吐请求，会在码头集中处理，这些请求可能会被合并，并根据优先级从仓库获取数据<strong>以实现数据传输效率的最大化</strong>；被码头工人最终装箱完（颜色混合、硬件抗锯齿）的像素数据也会被码头发往仓库中的帧缓冲。</li>
</ul>
<hr>
<h3 id="干活主力TPC"><a href="#干活主力TPC" class="headerlink" title="干活主力TPC"></a>干活主力TPC</h3><p><strong>TPC（Texture Processing Clusters）</strong>，是统一的硬件架构，可以处理顶点，片元，计算着色器的任务。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710134553236.png" alt="image-20220710134553236"></p>
<p>我们可以将TPC看成一个个子公司，这家黑心企业里一共有8个，我们任意挑选一间来看看。</p>
<blockquote>
<p>跟<strong>数量</strong>相关的参数我们都不需要太过关注，因为不同架构各不一样，同一架构不同价位的GPU也不尽相同（毕竟老黄刀法了得），理解其工作原理更为重要，如果要为特定GPU做优化，可以去官网查看更为具体的参数信息。</p>
</blockquote>
<p><strong>Geometry Controller</strong>：从名称上看，它是光栅化前几何阶段的大管家，负责<strong>顶点属性</strong>在<strong>芯片内</strong>的输入输出事宜，几何着色器这种增减顶点改变拓扑结构的骚操作也得麻烦它。不过，<strong>顶点着色器和几何着色器的运算指令仍然是由SM执行的</strong>，Geometry Controller会把最终结果送到<strong>Viewport/clip/setup/raster/zcull block模块</strong>去进行光栅化等步骤，或者<strong>Stream Out</strong>回内存交给程序员们揉搓。（该部件在Fermi架构中被升级成了<strong>PolyMorph Engine</strong>，我们会在Fermi架构章节里进一步研究）</p>
<p><strong>SMC（SM controller）</strong>：正如上一章讨论的，Tesla是统一的图形和并行计算架构，顶点、几何、片元着色器，甚至与图形无关的并行运算任务（CUDA），都由同样的硬件SM来运算。SMC负责将来自总部的各种任务，<strong>拆分打包成Warp</strong>（下一节会详细介绍）交给其中一个部门（SM）处理。除此外，SMC还<strong>负责协调SM与共用部门Texture unit之间的工作</strong>，以实现对外部纹理资源的获取，而显存中其他非纹理资源的读写甚至原子操作则会<strong>通过ROP与外界打交道</strong>。整体来看，SMC又负责对接外界资源，又负责内部任务分配，以实现复杂但至关重要的<strong>负载平衡</strong>，是名副其实的子公司高管。</p>
<p><strong>Texture Unit</strong>：包含4个纹理地址生成器和8个滤波单元（支持全速的2:1各项向异性过滤）。与SM内的指令全是标量运算不同，纹理单元的指令源是<strong>纹理坐标</strong>，输出是经过<strong>插值</strong>的纹理值（最常见的如RGBA），都是向量。拿到的纹理数据会存Tex L1 cache里，因为千辛万苦从外面搬进来的数据以后没准还有用呢。</p>
<h3 id="一条船上的蚂蚱"><a href="#一条船上的蚂蚱" class="headerlink" title="一条船上的蚂蚱"></a>一条船上的蚂蚱</h3><p>采访完干活的人，咱们接下来就得看看他们所要做的事情了。那么，我们得从最源头找起，他们干的活，最初可能是一段着色器代码，也可能是一段CUDA Kernel程序，都是高级语言，它们会被编译成中间指令，然后被优化器转化为二进制GPU指令。<strong>中间指令如果是矢量指令（SIMD），也会被转换为多条 Tesla SM 标量指令</strong>，比如4维向量相加，会被拆成4个标量相加，因为英伟达已经在Tesla里干掉了运算SIMD指令的计算单元。</p>
<p><strong>ISA（Instruction Set Architecture）</strong>：那么都会生成哪些指令呢？主要有三类：</p>
<ol>
<li><strong>运算</strong>：浮点整数等加法乘法、最小最大、比较、类型转换等基础运算以及超越函数等复杂运算。</li>
<li><strong>流控制</strong>：分支、调用、返回、中断、同步</li>
<li><strong>内存访问</strong>：包括对各类内存的读写、原子操作</li>
</ol>
<p>说了这么多，其实只要知道，<strong>不管多复杂的程序，层层传递到SM里，最终交到社畜们手中的就是一条条的指令</strong>。那这些活到底有什么特殊的呢？交给CPU不也能做吗？之所以交给GPU做，就是因为这些指令不只需要做一遍。比如一个顶点着色器，每有一个顶点数据，就得开一个线程把这个指令做一遍。</p>
<p>而实际上，SMC拿到一个着色器的所有指令后，每次会把这些指令<strong>以32个线程为单位</strong>分发给SM，而<strong>负责执行完这个着色器所有指令的32线程，就称为一个Warp</strong>。指令存在了指令cache里，MT（multi-threaded） Issue<strong>每次拿出一条指令</strong>发给手底下的SP或SFU们执行。诶？可是一个SM里SP只有8个，怎么运行32个线程呀，答案是每个SP连续干四次不就行了嘛？（卧槽，真不要脸）。<strong>SP是负责干活的硬件，线程是逻辑上负责完整运行完一个着色器所有指令的概念</strong>，确实没必要一一对应。SFU也是同理。</p>
<p>一个MT Issue发号施令一次，手底下的SP或SFU就吭哧吭哧将一条指令合计执行32次，这就是<strong>SIMT（Single-instruction, multiplethread）</strong>，GPU正是基于SIMT而设计的。</p>
<p>但是仔细想想，每个线程真的一定执行相同的指令吗？程序可不是简简单单一条一条往下走，还有分支和循环等指令会改变程序流向，<strong>由于每个线程输入的数据不同，很有可能会进入不同的分支</strong>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710135929296.png" alt="image-20220710135929296"></p>
<p>那该怎么办才好呢？</p>
<ul>
<li><strong>编译器可以进行特殊情况下的分支预测</strong>，来判断Warp中所有线程是否必然进入同一分支（比如条件是传入的定值，并非经过实际运算的值）</li>
<li>如果无法预测，则不得不在执行时付出点指令开销来进行<strong>Warp Voting</strong>，如果投票出来该Warp的所有线程还是只走一条分支，那么就还好，大家可以一起跳过其他所有分支，否则<strong>不同分支就只能串行，不进入某一分支的线程将被mask。</strong>即使只有一个线程进入了某一个分支，其他31个线程也得等着它执行完，这就是<strong>锁步运行。</strong></li>
</ul>
<p><strong>就像被绑到同一条船上的蚂蚱，同进退共生死，想要一条指令同时指挥32个线程，那么灵活性自然也在获得效率的时候被一并献祭了，因为凡事皆有代价。</strong></p>
<h3 id="活儿可以等，打工人不能等"><a href="#活儿可以等，打工人不能等" class="headerlink" title="活儿可以等，打工人不能等"></a>活儿可以等，打工人不能等</h3><p>看到这，总感觉也没有那么神奇，GPU无非就是仗着自己运算单元多一点儿所以算得快呗，创造大量就业的公司也能算黑心公司吗？别着急，对大量元器件的探访，对Warp概念的摸查，都是对最终Warp调度机制大揭秘的铺垫，真相即将浮出水面。</p>
<p>我们来看这么一个现状：当前硬件的计算速度比访问内存的速度快几个数量级，<strong>瓶颈往往在内存访问上</strong>。当SP遇到内存访问指令，会由SMC向外界请求数据（要么通过纹理单元要么通过ROP），那在漫长的等待过程中，SP是不是只能摸鱼了？</p>
<blockquote>
<p>社畜SP：“没办法呀，我也不是真的想摸鱼，但是没数据我干不了接下来的活呀 :）”<br>主管MT Issue：“是的，这个Warp只能等了，毕竟不同指令间有数据依赖，着色器里的代码总不能跳着执行。”<br>社畜SP：“是呀是呀，这活总得按部就班，才不会忙中出错嘛”<br>子公司高管SMC：“总部摊派给我们的活多着呢，我特意拆分成了好多个Warp让你们执行，就是想避免你们带薪拉屎。一个Warp要拿数据，我去帮你们联系就行，你们赶紧先去做其他Warp！”<br>于是，整个部门007的日常开始了。</p>
</blockquote>
<p>这就是<strong>延迟隐藏</strong>的真相了。是的，公司特意搞了一个指令cache，就是<strong>让SM能够存下足够多的Warp</strong>（Tesla架构最多24个，这些Warp可以是不同类型的，比如顶点着色器、片元着色器甚至是CUDA程序），以在出现内存阻塞时快速切换到其他可以执行的Warp上，等拿到数据了再切回原来的Warp就行。毕竟，读写数据并不需要SP们费心，有足够多的Warp让SP们007，这家公司才有可能蒸蒸日上。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-29d8a02a890d4174d8d30f9241b46d88_r.jpg" alt="preview"></p>
<p>原来这就是并行的真相：可不是简单的计算单元并行就可以了，而是<strong>所有元器件尽可能都不要停下来</strong>。说到所有元器件，自然MT Issue主管也跑不了，大家都是打工人，谁也不比谁高贵。</p>
<p>MT Issue从原来分发一个Warp的一条指令，变成了从多个Warp里挑出一个Warp执行其之前执行到的接下来的指令。至于如何调度，有<strong>复杂的计分板根据Warp类型、指令类型和公平性原则等来量化每一个待选的Warp</strong>，每两个处理器周期，MT Issue就从中挑出一个得分最高的Warp分配给对应的元器件去执行。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-07c156f620b46a6287e759dcf00f93cf_r.jpg" alt="preview"></p>
<p>每个SP只有8个，做完Warp一条指令需要4个周期，那么MT Issue为什么是两个处理器周期就分发一次指令呢？因为还有SFU啊！SP在运行的时候，SFU可不能闲着，2个周期分发一次指令的频率，就可以保证MT Issue有充足的时间给SFU挑选一个需要其运行的Warp，这样一来，<strong>所有员工就都能满负荷运转了，只要手里还有Warp没执行完，谁也别想停</strong>。</p>
<p>原来这就是高性能并行运算，原来这就是血汗工厂<strong>，一切都经过精心设计，势必要榨干每一个元器件的性能</strong>，背后的原因令人暖心。</p>
<p>最后还剩下一个小问题可以探讨，一个Warp线程的多少对性能有什么影响呢？如果粒度太粗，则可供调度的 Warp就会太少，不利于延迟隐藏； 如果粒度太小，则每次切换所执行的线程就太少， 切换 Warp的相对成本就变高了。</p>
<p>Warp调度是整个GPU架构最核心的内容了，<strong>不同的架构，元器件的名字可能会变，数量可能会变，会拆分或合并，但是延迟隐藏的这一特性却始终未变</strong>。</p>
<h2 id="从图形到通用计算"><a href="#从图形到通用计算" class="headerlink" title="从图形到通用计算"></a>从图形到通用计算</h2><p>如果我们仔细观察，可以发现，全称为图形处理单元的GPU，<strong>其最基本的计算部门——SM，已经跟图形没有半毛钱关系了</strong>。这一切都是NVIDIA有意为之，把各种图形相关的操作剥离成独立的硬件单元（Geometry Controller、Raster等），把计算单元SM解耦出来，以<strong>开启和拥抱更加广阔的并行计算市场</strong>。</p>
<p>因为图形任务的整体流程是固定的已知的，所以形成了<strong>相对固定的图形管线</strong>，只抠出几个重要的环节（如顶点着色器、片元着色器等）可供编程，GPU就可以弄出专门的硬件去做那些必定要做的不可编程的模块（比如光栅化）以提高效率。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-458a6b35cd6a371dc3838594422d9e4f_r.jpg" alt="preview"></p>
<p>然而，<strong>效率的提高意味着自由的丧失</strong>，在这条相对固定的图形管线，我们设置完最开始的<strong>顶点输入数据</strong>后，这些输入该如何分配线程运行，以及完成顶点计算后如何光栅化成片元，再继续分配多少线程去运行片元计算，这些事情其实都是<strong>对程序员隐藏</strong>的。</p>
<p>而在通用计算管线里，所有线程都不可避免要由程序员去分配与调用，因为既然“通用”，那就可能用来处理任何工作，<strong>每个线程要对应的任务就不再是固定的顶点或片元，而可能是任何我们想做的事</strong>。那么<strong>要分配多少线程，每个线程要负责处理什么工作</strong>（不仅是如何计算，还有要获取多少数据，要输出什么），所有的一切，事无巨细全都由程序员说了算。</p>
<p>除此之外，通用计算管线与图形管线相比，还有一个最大的不同：我们分配的这些线程是<strong>协作式</strong>的，我们<strong>可以根据它们的线程ID分配它们干不同的活，它们之间还需要数据传递</strong>。也不是说图形管线发出来的线程完全不需要协作和数据传递，只是所有的协作模式已经被定死了，不需要我们操心，比如：<strong>执行片元任务的时候是以每四个线程为单位的</strong>，以方便计算它们之间数据的差值（ddx、ddy）。</p>
<p>正因为通用管线释放了这么多的自由度，使得其性能的上限被提高了，我们可以<strong>根据具体任务，分配线程，并设计它们的协作模型以及数据依赖关系</strong>。不过，性能的上限是需要我们自己去探索达到的，如果缺乏对硬件的基本理解与优化技巧，深不可测的性能下限也在那等着我们。</p>
<h2 id="CUDA和计算着色器"><a href="#CUDA和计算着色器" class="headerlink" title="CUDA和计算着色器"></a>CUDA和计算着色器</h2><p>卖弄这么久的通用管线，是时候来看看它们到底是什么了。<strong>CUDA（Compute Unified Device Architecture）</strong>是最先被推出的，它轻装上阵彻底和图形划清了界限，成为了许多非图形学背景科研人员的并行计算平台。</p>
<p>后来，随着各种图形算法日益复杂，搞图形的人发现CUDA真香，也眼馋着想用上通用计算大杀器，所以各个API就相继推出了计算着色器。反正<strong>支持这套东西的底层硬件都是一样的</strong>，无非就是换了一堆名词来包装出这套一模一样的通用计算模型而已。</p>
<h3 id="线程组织结构"><a href="#线程组织结构" class="headerlink" title="线程组织结构"></a>线程组织结构</h3><p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-d9689b21d2fcac3045886bdfcee3f565_720w.jpg" alt="img"></p>
<p>CUDA线程的三级组织结构为：<strong>Grid-Block-Thread</strong>，每个Block包含多少线程在核函数中写死，<strong>Block是协作发生的组织单位（因此也被称为CTA，cooperative thread array）</strong>，里面的线程可以<strong>通过共享内存传递数据</strong>。每个Grid包含多少Block，由应用程序在每次调用时指定，同一个Grid的所有Block之间则是完全独立的，没有数据依赖。</p>
<p>因为<strong>线程与任务之间的映射</strong>是由我们决定的，那么我们自然需要知道每一个线程的ID，才能通过它获取到对应的数据，执行对应的计算任务，将计算结果写到对应的内存中。不过因为其三级组织结构，而且每一级结构可以支持三维的索引（上图只显示了2维），光有一个ID可能不能满足我们的需求。当然我们都可以自己算出来，但鉴于其需要被高频使用，因此不同API全都提供了一堆内置变量，来描述ID的不同表示，以避免我们自己计算浪费性能。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-36f03e7fa80a9530c71ad87faca8034a_720w.jpg" alt="img"></p>
<h3 id="真正的并行单元是Warp"><a href="#真正的并行单元是Warp" class="headerlink" title="真正的并行单元是Warp"></a>真正的并行单元是Warp</h3><p>又是三级线程组织结构，又是三维的线程ID映射，初学起来让人头晕脑胀，但是我们别忘了，无论上层的概念如何复杂，<strong>底层的硬件执行单元都是SM，真正的并行单位始终是Warp</strong>。因此优化的基础大多是以Warp为主角的，比如：</p>
<ul>
<li><strong>最好为每个Block分配Warp线程数（32）的整数倍线程数</strong>。因为不管多少线程都要拆分成Warp单位去执行，33个线程与64个线程同样需要执行两个Warp。</li>
<li><strong>同一分支要尽可能挤到同一Warp里。</strong>如果设计的算法中，不同的线程不得不执行不同的分支，比如Warp1要执行分支A和B，Warp2也要执行分支A和B，如果能让Warp1只执行分支A，而Warp2只执行分支B，就能获得性能的提升。（因为每个线程要做什么都是我们说了算，因此给了我们这样的优化空间）</li>
<li><strong>如果内存读写指令都只由一个Warp执行，那么无需同步</strong>。因为一个Warp内的线程本身就是锁步运行的，因此肯定不需要同步。<strong>但如果是不同Warp之间存在数据依赖，则不得不同步</strong>。比如一个先写后读的常见例子：Warp1的线程要读取由Warp1其他线程写入到共享内存的数据，则无需同步，因为该数据必定已经被写入；而Warp1的线程要读取由Warp2线程写入到共享内存的数据，则必须同步，因为<strong>Warp1开始执行读取指令的时候，Warp2执行到哪里了则无法预料，因为Warp的调度是硬件决定的，对程序员是不透明的</strong>。</li>
</ul>
<h2 id="分级“物流”系统"><a href="#分级“物流”系统" class="headerlink" title="分级“物流”系统"></a>分级“物流”系统</h2><p>到目前为止，我们对GPU架构的理解，还差最后一块拼图：<strong>内存——支撑GPU这整座血汗工厂高速运转的物流系统</strong>。计算得再快，如果物流系统跟不上，那也白搭。（特别是当今硬件算力过剩，带宽吃紧的局面）</p>
<p>就像有国道省道，也会有村间小路，有主动脉肺动脉，也会有毛细血管一样，GPU中分级的“物流”系统，也是非常自然的设计。让我们以CUDA与各个内存如何打交道为例，一一介绍：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/v2-b3501fecde229b3f4223f609d67bda03_720w.jpg" alt="img"></p>
<h3 id="Global-Memory与L2-cache"><a href="#Global-Memory与L2-cache" class="headerlink" title="Global Memory与L2 cache"></a>Global Memory与L2 cache</h3><p>如果大家还有印象，第一章我们介绍过这两个东西。Global Memory（DRAM），就是位于显卡上（GPU外）的显存，<strong>每一块显存都会与GPU内的对应的一个L2 cache相连</strong>。L2 cache是在SM之外的，因此可以供所有SM共同使用。</p>
<p>不同Grid的执行是串行的，如果他们存在对同一块显存的数据依赖，则由硬件负责同步。<strong>一个Warp中的连续线程访问连续的内存，可以被合并为一条内存读取指令</strong>，能显著提高效率。</p>
<h3 id="Shared-Memory与L1-cache"><a href="#Shared-Memory与L1-cache" class="headerlink" title="Shared Memory与L1 cache"></a>Shared Memory与L1 cache</h3><p>共享内存和L1 cache位于SM中，Tesla架构的L1 cache只用于缓存纹理数据，之后的架构则和共享内存占据相同的硬件单元，并<strong>可以由用户配置两者的大小</strong>。</p>
<p>通用管线的协作线程模型能够高效运行的秘密全在共享内存上，<strong>因为其位于SM中，读写速度肯定远高于主存与L2 cache</strong></p>
<p>而共享内存是对一个block内的所有线程可见的，这意味着<strong>一个block内所有线程必定位于同一个SM中</strong>。而同一个grid的不同block则不一定，因此不同block之间是老死不相往来无法通信的（如果想实现更高自由度更多粒度的同步，可以使用<a href="https://link.zhihu.com/?target=https://developer.nvidia.com/blog/cooperative-groups/">合作组</a>）。这也是为什么一个block的最大线程数有所限制，因为一个SM能容纳的Warp是有限的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Icecorn/icecorn-pic/img/image-20220710142551173.png" alt="image-20220710142551173"></p>
<p>一个warp32线程可能需要同时对共享内存进行读写，因此需要考虑<strong>bank冲突</strong>的问题。</p>
<p>简单讲，共享内存的带宽是有限制的，<strong>支持同时32个bank的读写，但是每个bank只能读写32位数据</strong>。多个地址会被映射到同一个bank，如果有多个线程想要同时读写同一个bank的数据，则不得不变成<strong>串行</strong>执行。</p>
<p>读内存现在的硬件都有<strong>广播</strong>的功能，不会出现bank冲突，但是写内存则需要小心的安排每个线程要写入的内存地址，<strong>尽量保持每个线程都映射到不同的bank中</strong>，以保持warp指令的并行性。</p>
<h3 id="Local-Memory与Register-Files"><a href="#Local-Memory与Register-Files" class="headerlink" title="Local Memory与Register Files"></a><strong>Local Memory与Register Files</strong></h3><p>每一个线程都有自己运行所需的局部变量，存放在<strong>寄存器文件</strong>中，如果存不下会溢出到L1 cache中，如果还存不下会被一路驱逐出去，贬谪到L2甚至到主存中。（性能会受到毁灭性打击）</p>
<p>最初的局部变量其他线程是无法访问的，但是较新的硬件支持了<strong>Shuffle操作</strong>，可以在一个Warp的线程间直接传递数据，比通过共享内存来回读写数据还快。</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://icecorn.github.io/2022/07/01/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%B8%80)%20Tesla%E6%9E%B6%E6%9E%84/" title="GPU架构（一）|Tesla架构" target="_blank" rel="external">http://icecorn.github.io/2022/07/01/GPU架构/GPU架构系列(一) Tesla架构/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/Icecorn" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/Icecorn" target="_blank"><span class="text-dark">Icecorn</span><small class="ml-1x">Life is Fantastic ~</small></a></h3>
        <div>一个喜欢推理小说和coding的宝可梦训练家~</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/07/02/GPU%E6%9E%B6%E6%9E%84/GPU%E6%9E%B6%E6%9E%84%E7%B3%BB%E5%88%97(%E4%BA%8C%EF%BC%89Fermi%E6%9E%B6%E6%9E%84/" title="GPU架构（二）|Fermi架构"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/06/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%B8%80%E6%96%87%E6%90%9E%E5%AE%9A%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" title="单例模式|一文搞懂单例模式！"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">    <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        &copy; 2022 Icecorn
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>